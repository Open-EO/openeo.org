(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{492:function(e,t,s){"use strict";s.r(t);var n=s(4),a=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"user-defined-functions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#user-defined-functions"}},[e._v("#")]),e._v(" User-defined functions")]),e._v(" "),t("p",[e._v("The abbreviation "),t("strong",[e._v("UDF")]),e._v(" stands for "),t("strong",[e._v("user-defined function")]),e._v(". With this concept, users are able to upload custom code and have it executed e.g. for every pixel of a scene, allowing custom calculations on server-side data that are not (easily) covered with "),t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html"}},[e._v("pre-defined processes")]),e._v(" or user-defined processes. While openEO UDFs are in principle language-agnostic, we currently implement UDFs for Python and R.")],1),e._v(" "),t("h2",{attrs:{id:"users"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#users"}},[e._v("#")]),e._v(" Users")]),e._v(" "),t("p",[e._v("You can run UDFs with any client (including JavaScript and Web Editor), but the code you can execute on the server will be limited to Python and R.\nAll openEO clients allow to run UDFs via the pre-defined process "),t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#run_udf"}},[t("code",[e._v("run_udf")])]),e._v(" if the back-end implements UDFs. You can check the "),t("a",{attrs:{href:"https://hub.openeo.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("openEO Hub"),t("OutboundLink")],1),e._v(" for back-ends that support user-defined functions. There's also "),t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#run_udf_externally"}},[t("code",[e._v("run_udf_externally")])]),e._v(" if you want to host UDFs yourself (see back-end instructions below), but the process is still experimental and not widely supported yet. If we refer to "),t("code",[e._v("run_udf")]),e._v(" below and the back-end supports it, you can also use "),t("code",[e._v("run_udf_externally")]),e._v(" without it being explicitly mentioned.")],1),e._v(" "),t("p",[e._v("As data cubes can be very large, the back-end may only be able to run your code on a smaller chunk of the whole cube. So you need to help the server a bit, by designing your code to work on smaller piece of data. This can be done by using data cube processes that run the UDF on smaller chunks of the data. There are a number of pre-defined processes that can run UDFs on such chunks, for example:")]),e._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#aggregate_spatial"}},[t("code",[e._v("aggregate_spatial")])]),e._v(": Reduces pixels within geometries to a single value using an UDF")],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#apply"}},[t("code",[e._v("apply")])]),e._v(": Applies an UDF to each pixel (it might also be slow to make the chunks too small though)")],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#apply_dimension"}},[t("code",[e._v("apply_dimension")])]),e._v(": Applies an UDF to all pixels along a dimension, without changing the number of values")],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#apply_neighborhood"}},[t("code",[e._v("apply_neighborhood")])]),e._v(": Applies an UDF to all pixels in a multidimensional neighborhood")],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#merge_cubes"}},[t("code",[e._v("merge_cubes")])]),e._v(": Reduces overlapping pixels of the data cubes to a single value")],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#reduce_dimension"}},[t("code",[e._v("reduce_dimension")])]),e._v(": Reduces values along a dimension using an UDF")],1)]),e._v(" "),t("p",[e._v("There are more processes that accept and run a sub-process. Each of them can also be used to run UDFs.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),t("p",[e._v("Not all functions will require you to write a UDF. For instance, if you want to take the absolute value of your data cube, you can simply "),t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#apply"}},[t("code",[e._v("apply")])]),e._v(" the predefined "),t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#absolute"}},[t("code",[e._v("absolute")])]),e._v(") process. In fact, it is recommended to try and use predefined functions first, as they can be more efficiently implemented.")],1)]),e._v(" "),t("p",[e._v("The following chapters have further information on UDF usage in the openEO clients:")]),e._v(" "),t("h3",{attrs:{id:"javascript"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javascript"}},[e._v("#")]),e._v(" JavaScript")]),e._v(" "),t("p",[e._v("The easiest way to run UDFs in the JavaScript client is to use the "),t("a",{attrs:{href:"https://open-eo.github.io/openeo-js-client/latest/Builder.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("process builder"),t("OutboundLink")],1),e._v(". You can use the builder to execute the "),t("code",[e._v("run_udf")]),e._v(" process. A simple example:")]),e._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Connect to the back-end first and store the connection in the variable `con`...")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Discover UDF runtimes")]),e._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" con"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("listUdfRuntimes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Upload a UDF file to the server as udf.py, the source can only be a local path in a NodeJS environment")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" con"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("uploadFile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/home/user/myudf.py'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'udf.py'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a process builder")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" builder "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" con"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("buildProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Load some data from the back-end")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" datacube "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" builder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("load_collection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Sentinel-2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2018"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2019"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a sub-process that runs a UDF")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("udfProcess")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// This assumes that a file udf.py with the Python UDF code has been uploaded to the server before, you can also directly insert the UDF code instead. ")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// You need to replace `Python` and `3.7` with the respective runtime identifier and version as returned in UDF discovery")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("run_udf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"udf.py"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Python"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Call the UDF as part of the reduce_dimension process to reduce the bands to a single value")]),e._v("\ndatacube "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" builder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("reduce_dimension")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("datacube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" udfProcess"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bands"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Further process the data cube or save it using save_result...")]),e._v("\n")])])]),t("h3",{attrs:{id:"python"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#python"}},[e._v("#")]),e._v(" Python")]),e._v(" "),t("p",[e._v("The Python client has "),t("a",{attrs:{href:"https://open-eo.github.io/openeo-python-client/udf.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("separate documentation on UDFs"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h3",{attrs:{id:"qgis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#qgis"}},[e._v("#")]),e._v(" QGIS")]),e._v(" "),t("p",[e._v("QGIS doesn't natively support running UDFs yet, but you can use copy and paste user-defined processes that include UDFs.")]),e._v(" "),t("h3",{attrs:{id:"r"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#r"}},[e._v("#")]),e._v(" R")]),e._v(" "),t("p",[e._v("There's no dedicated UDF documentation for R yet, but you can have a look at the "),t("a",{attrs:{href:"https://github.com/Open-EO/openeo-r-udf#usage",target:"_blank",rel:"noopener noreferrer"}},[e._v("getting started guide and examples in the UDF server repository"),t("OutboundLink")],1),e._v(" for now.")]),e._v(" "),t("h3",{attrs:{id:"web-editor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-editor"}},[e._v("#")]),e._v(" Web Editor")]),e._v(" "),t("p",[e._v("Running UDFs in the Web Editor just requires you to drag the "),t("code",[e._v("run_udf")]),e._v(" process into the model builder. Afterwards you can edit the process parameters to your needs. You have to set the environment / programming language to run the UDF with and then you can either directly program a UDF in the code editor or select an UDF file you have previously uploaded to the user workspace.")]),e._v(" "),t("h2",{attrs:{id:"back-ends"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#back-ends"}},[e._v("#")]),e._v(" Back-ends")]),e._v(" "),t("p",[e._v("If you'd like to offer user-defined functions for your users, you need to implement either the process "),t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#run_udf"}},[t("code",[e._v("run_udf")])]),e._v(" or "),t("RouterLink",{attrs:{to:"/documentation/1.0/processes.html#run_udf_externally"}},[t("code",[e._v("run_udf_externally")])]),e._v(" (or both). Both usually require you to access UDF servers via the "),t("a",{attrs:{href:"https://open-eo.github.io/openeo-udf/api_docs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("UDF API"),t("OutboundLink")],1),e._v(". For the process "),t("code",[e._v("run_udf")]),e._v(" you may bypass the API and exchange data directly between the openEO back-end and the openEO UDF servers for performance reasons.")],1),e._v(" "),t("p",[t("code",[e._v("run_udf")]),e._v(" allows users to run their code on your infrastructure. This can be done using one of the UDF server implementations in "),t("a",{attrs:{href:"https://github.com/Open-EO/openeo-udf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Python"),t("OutboundLink")],1),e._v(" or "),t("a",{attrs:{href:"https://github.com/Open-EO/openeo-r-udf",target:"_blank",rel:"noopener noreferrer"}},[e._v("R"),t("OutboundLink")],1),e._v(". Please note that both UDF servers are "),t("strong",[e._v("drafts")]),e._v(" and still need work to improve performance and make them secure! This is not yet an out-of-the-box solution for running UDFs securely and fast.")])])}),[],!1,null,null,null);t.default=a.exports}}]);