(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{520:function(e,o,t){"use strict";t.r(o);var a=t(4),r=Object(a.a)({},(function(){var e=this,o=e._self._c;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"getting-started-with-openeo-and-xarray-and-dask"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#getting-started-with-openeo-and-xarray-and-dask"}},[e._v("#")]),e._v(" Getting started with openEO and Xarray and Dask")]),e._v(" "),o("p",[e._v("As a back-end provider who wants to provide its datasets, processes and infrastructure to a broader audience through a\nstandardized interface you may want to implement a driver for openEO.")]),e._v(" "),o("p",[e._v("First of all, you should read carefully the "),o("RouterLink",{attrs:{to:"/documentation/1.0/developers/backends/getting-started.html"}},[e._v("getting started guide for service providers")]),e._v(".")],1),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),o("p",[e._v("The Xarray-Dask implementation for openEO is not a full-fledged out-of-the-box openEO back-end,\nbut can be part of the infrastructure for the data management and processing part.\nIn detail it can be used as data source for "),o("RouterLink",{attrs:{to:"/documentation/1.0/developers/api/reference.html#tag/EO-Data-Discovery"}},[e._v("EO Data Discovery")]),e._v(" and e.g.\nin combination with a Dask cluster as processing back-end for "),o("RouterLink",{attrs:{to:"/documentation/1.0/developers/api/reference.html#tag/Data-Processing"}},[e._v("Data Processing")]),e._v(".\nIn any case, a "),o("a",{attrs:{href:"#http-rest-interface"}},[e._v("HTTP REST interface must be available in front of process implementations to properly answer openEO requests")]),e._v(".")],1)]),e._v(" "),o("p",[e._v("There are two main components involved with openEO and Xarray:")]),e._v(" "),o("ol",[o("li",[o("a",{attrs:{href:"#process-graph-parser-for-python"}},[e._v("Process Graph Parser for Python")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#python-processes-for-openeo"}},[e._v("Python Processes for openEO")])])]),e._v(" "),o("h2",{attrs:{id:"process-graph-parser-for-python"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#process-graph-parser-for-python"}},[e._v("#")]),e._v(" Process Graph Parser for Python")]),e._v(" "),o("ul",[o("li",[e._v("Repository: "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-pg-parser-networkx",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-pg-parser-networkx"),o("OutboundLink")],1)])]),e._v(" "),o("p",[e._v("This pg-parser parses OpenEO process graphs from raw JSON into fully traversible networkx graph objects.")]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("ProcessRegistry")]),e._v(" can be imported from the pg-parser and includes "),o("code",[e._v("Process")]),e._v(" objects, that include a")]),e._v(" "),o("ul",[o("li",[e._v("spec: Process definition (e.g. https://github.com/Open-EO/openeo-processes)")]),e._v(" "),o("li",[e._v("implementation: Callable process implementation (https://github.com/Open-EO/openeo-processes-dask/tree/main/openeo_processes_dask/process_implementations)")]),e._v(" "),o("li",[e._v("namespace")])]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("ProcessRegistry")]),e._v(" automatically maps from the name of a process to the "),o("code",[e._v("spec")]),e._v(" and to the "),o("code",[e._v("implementation")]),e._v(".\nEvery "),o("code",[e._v("Process")]),e._v(" in the "),o("code",[e._v("ProcessRegistry")]),e._v(" requires a "),o("code",[e._v("spec")]),e._v(", while "),o("code",[e._v("implementation")]),e._v(" and "),o("code",[e._v("namespace")]),e._v(" are optional.")]),e._v(" "),o("p",[e._v("An example on how to use the pg-parser can be found "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-pg-parser-networkx/blob/main/examples/01_minibackend_demo.ipynb",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("h2",{attrs:{id:"python-processes-for-openeo"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#python-processes-for-openeo"}},[e._v("#")]),e._v(" Python Processes for openEO")]),e._v(" "),o("ul",[o("li",[e._v("Repository: "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-processes-dask"),o("OutboundLink")],1)])]),e._v(" "),o("p",[e._v("This package includes the implementations of openEO processes, using Xarray and Dask. Currently, the "),o("code",[e._v("load_collection")]),e._v(" and "),o("code",[e._v("save_result")]),e._v(" process are not included as these implementations can differ widely for different backends.")]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("specs")]),e._v(" can be found in the "),o("code",[e._v("openeo-processes-dask")]),e._v(" as a submodule. That way, the specification and the implementation are stored close to each other.")]),e._v(" "),o("h2",{attrs:{id:"the-load-collection-and-save-result-process"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#the-load-collection-and-save-result-process"}},[e._v("#")]),e._v(" The load_collection and save_result process")]),e._v(" "),o("p",[e._v("As mentioned before, the "),o("code",[e._v("load_collection")]),e._v(" and "),o("code",[e._v("save_result")]),e._v(" processes are back-end-specific and therefore not included in "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-processes-dask"),o("OutboundLink")],1),e._v(". The "),o("a",{attrs:{href:"https://processes.openeo.org/#load_collection",target:"_blank",rel:"noopener noreferrer"}},[e._v("load_collection"),o("OutboundLink")],1),e._v(" process should return a "),o("code",[e._v("raster-cube")]),e._v(" object - to be compliant with the "),o("code",[e._v("openeo-processes-dask")]),e._v(" implementations, this should be realized by a "),o("code",[e._v("xarray.DataArray")]),e._v(" loaded with "),o("code",[e._v("dask")]),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"connection-to-odc-and-stac"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#connection-to-odc-and-stac"}},[e._v("#")]),e._v(" Connection to ODC and STAC")]),e._v(" "),o("p",[e._v("For testing purposes with "),o("code",[e._v("DataArrays")]),e._v(" - which can be loaded from one file - the "),o("code",[e._v("xarray.open_dataarray()")]),e._v(" function can be used to implement a basic version of "),o("code",[e._v("load_collection")]),e._v(".")]),e._v(" "),o("p",[e._v("Large data sets can be organised as "),o("code",[e._v("opendatacube Products")]),e._v(" or as "),o("code",[e._v("STAC Collections")]),e._v(".")]),e._v(" "),o("ul",[o("li",[o("p",[o("code",[e._v("opendatacube Products")]),e._v(": The implementation of "),o("code",[e._v("load_collection")]),e._v(" can include the "),o("code",[e._v("opendatacube")]),e._v(" function "),o("code",[e._v("datacube.Datacube.load()")]),e._v(". It is recommended to use the "),o("code",[e._v("dask_chunks")]),e._v(" parameter, when loading the data. The function returns a "),o("code",[e._v("xarray DataSet")]),e._v(", in order to be compliant with "),o("code",[e._v("openeo-processes-dask")]),e._v(", it can be converted to a "),o("code",[e._v("DataArray")]),e._v(" using the "),o("code",[e._v("Dataset.to_array(dim='bands')")]),e._v(" function. A sample "),o("code",[e._v("load_collection")]),e._v(" process using OpenDatacube "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo_odc_driver/blob/c197387c10f8fef7d5573270a35961a278a18e1d/openeo_odc_driver/processing.py#L38",target:"_blank",rel:"noopener noreferrer"}},[e._v("can be found here"),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("li",[o("p",[o("code",[e._v("STAC Collections")]),e._v(": Alternatively, the "),o("code",[e._v("load_collection")]),e._v(" process can be implemented using the "),o("code",[e._v("odc.stac.load()")]),e._v(" function. To make use of "),o("code",[e._v("dask")]),e._v(", the "),o("code",[e._v("chunks")]),e._v(" parameter must be set. Just as in the previous case, the resulting "),o("code",[e._v("xarray DataSet")]),e._v(" can be converted to a "),o("code",[e._v("DataArray")]),e._v(" with "),o("code",[e._v("Dataset.to_array(dim='bands')")]),e._v(". A similar implementation is the one of the "),o("code",[e._v("load_stac")]),e._v(" process "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask/blob/9267e4ccffbbbf755cb7b8a43ba80d9483398314/openeo_processes_dask/process_implementations/cubes/load.py#L83",target:"_blank",rel:"noopener noreferrer"}},[e._v("available here"),o("OutboundLink")],1),e._v(".")])])]),e._v(" "),o("h2",{attrs:{id:"openeo-client-side-processing"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#openeo-client-side-processing"}},[e._v("#")]),e._v(" openEO Client Side Processing")]),e._v(" "),o("p",[e._v("The client-side processing functionality allows to test and use openEO with its processes locally, i.e. without any connection to an openEO back-end.\nIt relies on the projects "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-pg-parser-networkx",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-pg-parser-networkx"),o("OutboundLink")],1),e._v(", which provides an openEO process graph parsing tool, and "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-processes-dask"),o("OutboundLink")],1),e._v(", which provides an Xarray and Dask implementation of most openEO processes.")]),e._v(" "),o("p",[e._v("You can find more information and usage examples in the openEO Python client documentation "),o("a",{attrs:{href:"https://open-eo.github.io/openeo-python-client/cookbook/localprocessing.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("available here"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("h2",{attrs:{id:"adding-a-new-process"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#adding-a-new-process"}},[e._v("#")]),e._v(" Adding a new process")]),e._v(" "),o("p",[e._v("To add a new process, there are changes required in the "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-processes-dask"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("ol",[o("li",[e._v("Add the process spec")]),e._v(" "),o("li",[e._v("Add the process implementation")])]),e._v(" "),o("p",[e._v("The HTTP rest interface should have a "),o("code",[e._v("processes")]),e._v(" endpoint that reflects the process specs from "),o("code",[e._v("openeo-processes-dask")]),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"add-the-process-spec"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#add-the-process-spec"}},[e._v("#")]),e._v(" Add the process spec")]),e._v(" "),o("p",[e._v("Currently, "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-processes-dask"),o("OutboundLink")],1),e._v(" includes the process definitions as a "),o("code",[e._v("submodule")]),e._v(" in the "),o("code",[e._v("openeo-processes-dask/specs")]),e._v(". The submodule can be found under https://github.com/eodcgmbh/openeo-processes, which is a fork from https://github.com/Open-EO/openeo-processes to reflect which processes (with their implementations) are actually available in "),o("code",[e._v("openeo-processes-dask")]),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"add-the-process-implementation"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#add-the-process-implementation"}},[e._v("#")]),e._v(" Add the process implementation")]),e._v(" "),o("ol",[o("li",[e._v("Select a process from "),o("a",{attrs:{href:"https://processes.openeo.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("processes.openeo.org"),o("OutboundLink")],1),e._v(" which does not yet have an\nimplementation in "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-processes-dask"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("li",[e._v("Clone "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-processes-dask",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-processes-dask"),o("OutboundLink")],1),e._v(", checkout a new branch, and start implementing the missing process. Make sure you properly handle all parameters defined for this process. Add a test for your process in "),o("code",[e._v("openeo-processes-dask/tests")]),e._v(" ideally using dask. The "),o("code",[e._v("create_fake_rastercube")]),e._v(" from the "),o("code",[e._v("openeo-processes-dask/tests/mockdata")]),e._v(" can be used for testing, with the "),o("code",[e._v("backend")]),e._v(" parameter set to "),o("code",[e._v("numpy")]),e._v(" or "),o("code",[e._v("dask")]),e._v(".")]),e._v(" "),o("li",[e._v("Push your code and open a PR.")])]),e._v(" "),o("h2",{attrs:{id:"http-rest-interface"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#http-rest-interface"}},[e._v("#")]),e._v(" HTTP REST Interface")]),e._v(" "),o("p",[e._v("The next step would be to set up a HTTP REST interface (i.e. an implementation of the openEO HTTP API) for the new openEO environment.\nIt must be available in front of the process implementations to properly answer openEO client requests.\nCurrently, the "),o("a",{attrs:{href:"https://openeo.eodc.eu/v1.0",target:"_blank",rel:"noopener noreferrer"}},[e._v("EODC"),o("OutboundLink")],1),e._v(" and "),o("a",{attrs:{href:"https://openeo.eurac.edu/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Eurac Research"),o("OutboundLink")],1),e._v(" back-ends use Xarray and Dask and thus\nare the first implementations of back-ends to look at.")]),e._v(" "),o("ul",[o("li",[e._v("EODC is using a Python implementation, the "),o("a",{attrs:{href:"https://github.com/eodcgmbh/openeo-fastapi",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-fastapi"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("li",[e._v("Eurac Research relies on a Java based implementation, the "),o("a",{attrs:{href:"https://github.com/Open-EO/openeo-spring-driver",target:"_blank",rel:"noopener noreferrer"}},[e._v("openeo-spring-driver"),o("OutboundLink")],1)])]),e._v(" "),o("p",[e._v("If you have any questions, please "),o("RouterLink",{attrs:{to:"/contact.html"}},[e._v("contact us")]),e._v(".")],1)])}),[],!1,null,null,null);o.default=r.exports}}]);